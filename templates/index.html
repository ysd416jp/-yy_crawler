<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Webæ›´æ–°ãƒã‚§ãƒƒã‚«ãƒ¼</title>
<link rel="icon" href="/favicon.ico" type="image/svg+xml">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0e1117; color: #e0e0e0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
    min-height: 100vh; padding: 24px 16px;
  }
  .container { max-width: 640px; margin: 0 auto; }

  /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
  .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
  .header h1 { font-size: 1.4rem; font-weight: 700; color: #fff; }
  .icon-btn {
    width: 38px; height: 38px; border-radius: 50%;
    background: #1a1d24; border: 1px solid #2a2d35;
    color: #aaa; font-size: 18px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s; text-decoration: none;
  }
  .icon-btn:hover { background: #24272e; color: #fff; }

  /* --- è¿½åŠ ãƒœã‚¿ãƒ³ --- */
  .add-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 24px; }
  .add-btn {
    padding: 12px 0; border: none; border-radius: 10px;
    font-size: 0.92rem; font-weight: 600; cursor: pointer;
    color: #fff; transition: all 0.15s;
  }
  .add-btn:hover { transform: translateY(-1px); filter: brightness(1.15); }
  .add-btn-url { background: linear-gradient(135deg, #1a5c3a, #238b5e); }
  .add-btn-kw  { background: linear-gradient(135deg, #1a3d5c, #2370a0); }

  /* --- ãƒ¢ãƒ¼ãƒ€ãƒ« --- */
  .modal-overlay {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); z-index: 100;
    align-items: center; justify-content: center;
  }
  .modal-overlay.active { display: flex; }
  .modal {
    background: #1a1d24; border-radius: 14px; padding: 28px;
    width: 90%; max-width: 440px; border: 1px solid #2a2d35;
  }
  .modal h2 { font-size: 1.1rem; margin-bottom: 18px; color: #fff; }
  .modal label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 6px; margin-top: 14px; }
  .modal input, .modal select {
    width: 100%; padding: 10px 12px; border-radius: 8px;
    background: #0e1117; border: 1px solid #2a2d35; color: #e0e0e0;
    font-size: 0.9rem; outline: none; transition: border 0.15s;
  }
  .modal input:focus, .modal select:focus { border-color: #4a90e2; }
  .modal-actions { display: flex; gap: 10px; margin-top: 22px; }
  .btn-submit {
    flex: 1; padding: 10px; border: none; border-radius: 8px;
    background: #238b5e; color: #fff; font-weight: 600; font-size: 0.9rem;
    cursor: pointer; transition: all 0.15s;
  }
  .btn-submit:hover { background: #2aa06e; }
  .btn-cancel {
    padding: 10px 18px; border: 1px solid #333; border-radius: 8px;
    background: transparent; color: #999; cursor: pointer; font-size: 0.9rem;
  }
  .btn-cancel:hover { background: #1e2028; color: #ccc; }
  .hint { font-size: 0.72rem; color: #555; margin-top: 4px; }
  .source-toggle { display: flex; gap: 16px; margin-top: 6px; }
  .source-toggle label { display: inline-flex !important; align-items: center; gap: 5px; cursor: pointer; margin: 0 !important; font-size: 0.85rem; color: #bbb; white-space: nowrap; }
  .source-toggle input[type=radio] { accent-color: #4a90e2; margin: 0; }
  #custom-site-row { margin-top: 10px; }

  /* --- ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— --- */
  .section-title { font-size: 0.78rem; color: #666; font-weight: 600; letter-spacing: 0.04em; margin-bottom: 10px; }

  /* --- ã‚«ãƒ¼ãƒ‰ --- */
  .card {
    background: #1a1d24; border-radius: 10px; padding: 14px 16px;
    margin-bottom: 8px; display: flex; align-items: center;
    border: 1px solid #2a2d35; transition: border 0.15s; cursor: pointer;
  }
  .card:hover { border-color: #4a90e2; }
  .card-icon {
    width: 36px; height: 36px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 17px; margin-right: 14px; flex-shrink: 0;
  }
  .card-icon-url { background: #1a3d2a; }
  .card-icon-kw  { background: #1a2d4a; }
  .card-body { flex: 1; min-width: 0; }
  .card-title {
    font-size: 0.92rem; color: #fff; font-weight: 500;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .card-sub { font-size: 0.73rem; color: #666; margin-top: 2px; }
  .card-actions { display: flex; gap: 6px; flex-shrink: 0; margin-left: 10px; }
  .card-del {
    width: 32px; height: 32px; border-radius: 6px;
    background: transparent; border: 1px solid #2a2d35;
    color: #555; font-size: 13px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }
  .card-del:hover { background: #2a1a1a; border-color: #6a3030; color: #e05050; }

  /* --- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ --- */
  .status-list { margin-top: 24px; }
  .status-row {
    background: #14161c; border-radius: 6px; padding: 9px 14px;
    margin-bottom: 4px; font-size: 0.8rem; color: #777;
    border-left: 3px solid #2a2d35;
    display: flex; justify-content: space-between; align-items: center;
  }
  .status-ok { border-left-color: #238b5e; }
  .status-wait { border-left-color: #4a4a20; }
  .status-label { color: #aaa; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
  .status-badge { font-size: 0.75rem; flex-shrink: 0; margin-left: 8px; }

  /* --- ã‚«ãƒ¼ãƒ‰URLè¡¨ç¤º --- */
  .card-url {
    margin-top: 4px; font-size: 0.72rem; overflow: hidden;
    text-overflow: ellipsis; white-space: nowrap;
  }
  .card-url a {
    color: #4a90e2; text-decoration: none; opacity: 0.8;
    transition: opacity 0.15s;
  }
  .card-url a:hover { opacity: 1; text-decoration: underline; }

  /* --- ç©ºçŠ¶æ…‹ --- */
  .empty { text-align: center; padding: 60px 20px; color: #444; }
  .empty-icon { font-size: 2.4rem; margin-bottom: 12px; }
  .empty-text { font-size: 0.9rem; }

  /* --- ãƒ•ãƒƒã‚¿ãƒ¼ --- */
  .footer { text-align: right; color: #333; font-size: 0.68rem; margin-top: 40px; }
</style>
</head>
<body>
<div class="container">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="header">
    <h1>Webæ›´æ–°ãƒã‚§ãƒƒã‚«ãƒ¼</h1>
    <button class="icon-btn" onclick="location.reload()" title="æ›´æ–°">â†»</button>
  </div>

  <!-- è¿½åŠ ãƒœã‚¿ãƒ³ -->
  <div class="add-buttons">
    <button class="add-btn add-btn-url" onclick="openModal('url')">ï¼‹ ğŸŒ URLç›£è¦–</button>
    <button class="add-btn add-btn-kw"  onclick="openModal('kw')">ï¼‹ ğŸ” æ¤œç´¢ç›£è¦–</button>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: URLç›£è¦–è¿½åŠ  -->
  <div class="modal-overlay" id="modal-url">
    <div class="modal">
      <h2>ğŸŒ URLç›£è¦–ã‚’è¿½åŠ </h2>
      <form action="/add" method="post">
        <input type="hidden" name="mode" value="url">
        <label>ç›£è¦–ã™ã‚‹URL</label>
        <input type="url" name="url" placeholder="https://example.com" required>
        <label>ãƒã‚§ãƒƒã‚¯é–“éš”</label>
        <select name="freq">
          <option value="1">1æ™‚é–“ã”ã¨</option>
          <option value="4">4æ™‚é–“ã”ã¨</option>
          <option value="6" selected>6æ™‚é–“ã”ã¨</option>
          <option value="12">12æ™‚é–“ã”ã¨</option>
          <option value="24">24æ™‚é–“ã”ã¨</option>
        </select>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('url')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="submit" class="btn-submit">è¿½åŠ ã™ã‚‹</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: æ¤œç´¢ç›£è¦–è¿½åŠ  -->
  <div class="modal-overlay" id="modal-kw">
    <div class="modal">
      <h2>ğŸ” æ¤œç´¢ç›£è¦–ã‚’è¿½åŠ </h2>
      <form action="/add" method="post">
        <input type="hidden" name="mode" value="kw">
        <label>æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="text" name="keyword" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
        <label>æ¤œç´¢å…ˆ</label>
        <div class="source-toggle">
          <label><input type="radio" name="source_type" value="preset" checked onchange="toggleSource()"> ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
          <label><input type="radio" name="source_type" value="custom" onchange="toggleSource()"> æ–°è¦ã‚µã‚¤ãƒˆ (AIç”Ÿæˆ)</label>
        </div>
        <div id="preset-site-row">
          <select name="preset_source" id="source-select">
            <option value="x">X (Twitter)</option>
            <option value="indeed">Indeed</option>
            <option value="townwork">ã‚¿ã‚¦ãƒ³ãƒ¯ãƒ¼ã‚¯</option>
            <option value="jalan">ã˜ã‚ƒã‚‰ã‚“</option>
            <option value="hotpepper">ãƒ›ãƒƒãƒˆãƒšãƒƒãƒ‘ãƒ¼</option>
            <option value="google">Google</option>
          </select>
        </div>
        <div id="custom-site-row" style="display:none">
          <input type="text" name="custom_source" id="custom-source" placeholder="ã‚µã‚¤ãƒˆå (ä¾‹: é£Ÿã¹ãƒ­ã‚°, ãƒ¡ãƒ«ã‚«ãƒª)">
          <div class="hint">Gemini AIãŒæ¤œç´¢URLã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™</div>
        </div>
        <label>ãƒã‚§ãƒƒã‚¯é–“éš”</label>
        <select name="freq">
          <option value="1">1æ™‚é–“ã”ã¨</option>
          <option value="4">4æ™‚é–“ã”ã¨</option>
          <option value="6" selected>6æ™‚é–“ã”ã¨</option>
          <option value="12">12æ™‚é–“ã”ã¨</option>
          <option value="24">24æ™‚é–“ã”ã¨</option>
        </select>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('kw')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="submit" class="btn-submit">è¿½åŠ ã™ã‚‹</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ç·¨é›† -->
  <div class="modal-overlay" id="modal-edit">
    <div class="modal">
      <h2>âœï¸ ç›£è¦–è¨­å®šã‚’ç·¨é›†</h2>
      <form action="/edit" method="post" id="edit-form">
        <input type="hidden" name="row_index" id="edit-row-index">
        <input type="hidden" name="edit_mode" id="edit-mode">

        <div id="edit-url-fields" style="display:none">
          <label>ç›£è¦–URL</label>
          <input type="url" name="edit_url" id="edit-url" placeholder="https://example.com">
        </div>

        <div id="edit-kw-fields" style="display:none">
          <label>æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="text" name="edit_word" id="edit-word">
          <label>æ¤œç´¢å…ˆ</label>
          <input type="text" name="edit_memo" id="edit-memo">
        </div>

        <label>ãƒã‚§ãƒƒã‚¯é–“éš”</label>
        <select name="edit_freq" id="edit-freq">
          <option value="1">1æ™‚é–“ã”ã¨</option>
          <option value="4">4æ™‚é–“ã”ã¨</option>
          <option value="6">6æ™‚é–“ã”ã¨</option>
          <option value="12">12æ™‚é–“ã”ã¨</option>
          <option value="24">24æ™‚é–“ã”ã¨</option>
        </select>
        <div class="modal-actions">
          <button type="button" class="btn-cancel" onclick="closeModal('edit')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="submit" class="btn-submit">ä¿å­˜</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ç›£è¦–ä¸€è¦§ -->
  {% if rows %}
  <div class="section-title">ç›£è¦–ä¸­ ({{ rows|length }}ä»¶)</div>
  {% for row in rows %}
    {% set i = loop.index + 1 %}
    {% set word = row.get('word', '')|string %}
    {% set url = row.get('url', '')|string %}
    {% set memo = row.get('memo', '')|string %}
    {% set freq = (row.get('count', '') or row.get('freq', ''))|string %}
    {% set prev_hash = row.get('prev_hash', '')|string %}
    {% set is_url = (memo == 'HPæ›´æ–°') %}

    <div class="card" onclick="openEdit({{ i }}, '{{ 'url' if is_url else 'kw' }}', '{{ word|e }}', '{{ url|e }}', '{{ memo|e }}', '{{ freq }}')">
      <div class="card-icon {{ 'card-icon-url' if is_url else 'card-icon-kw' }}">
        {% if is_url %}ğŸŒ{% else %}ğŸ”{% endif %}
      </div>
      <div class="card-body">
        <div class="card-title">{{ url if is_url and url else word }}</div>
        <div class="card-sub">
          {{ freq }}æ™‚é–“ã”ã¨{% if not is_url %} ãƒ» {{ memo }}{% endif %}
        </div>
        {% if not is_url and url.strip() %}
        <div class="card-url" onclick="event.stopPropagation()">
          <a href="{{ url }}" target="_blank" rel="noopener">{{ url[:60] }}{% if url|length > 60 %}...{% endif %}</a>
        </div>
        {% endif %}
      </div>
      <div class="card-actions" onclick="event.stopPropagation()">
        <form action="/delete/{{ i }}" method="post" style="margin:0"
              onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
          <button type="submit" class="card-del" title="å‰Šé™¤">ğŸ—‘</button>
        </form>
      </div>
    </div>
  {% endfor %}

  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
  <div class="status-list">
    <div class="section-title">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
    {% for row in rows %}
      {% set word = row.get('word', '')|string %}
      {% set url = row.get('url', '')|string %}
      {% set memo = row.get('memo', '')|string %}
      {% set prev_hash = row.get('prev_hash', '')|string %}
      {% set is_url = (memo == 'HPæ›´æ–°') %}
      {% if is_url %}
        {% set label = url[:40] if url else word %}
        {% if prev_hash.strip() %}
          <div class="status-row status-ok">
            <span class="status-label">{{ label }}</span>
            <span class="status-badge">âœ… ç›£è¦–ä¸­</span>
          </div>
        {% else %}
          <div class="status-row status-wait">
            <span class="status-label">{{ label }}</span>
            <span class="status-badge">â³ åˆå›å¾…ã¡</span>
          </div>
        {% endif %}
      {% else %}
        {% set label = word %}
        {% if url.strip() %}
          <div class="status-row status-ok">
            <span class="status-label">{{ label }}</span>
            <span class="status-badge">âœ… URLç”Ÿæˆæ¸ˆ</span>
          </div>
        {% else %}
          <div class="status-row status-wait">
            <span class="status-label">{{ label }}</span>
            <span class="status-badge">â³ URLæœªç”Ÿæˆ</span>
          </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>

  {% else %}
  <div class="empty">
    <div class="empty-icon">ğŸ“¡</div>
    <div class="empty-text">ç›£è¦–é …ç›®ãŒã‚ã‚Šã¾ã›ã‚“<br>ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„</div>
  </div>
  {% endif %}

  {% if error %}
  <div style="background:#3a1a1a; border:1px solid #6a3030; border-radius:8px; padding:12px; margin-top:16px; color:#e05050; font-size:0.85rem;">
    {{ error }}
  </div>
  {% endif %}

  <div class="footer">v5.1.0</div>
</div>

<script>
function openModal(type) {
  document.getElementById('modal-' + type).classList.add('active');
}
function closeModal(type) {
  document.getElementById('modal-' + type).classList.remove('active');
}

// æ¤œç´¢å…ˆãƒˆã‚°ãƒ«ï¼ˆè¡¨ç¤ºåˆ‡æ›¿ã®ã¿ã€ä¸¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã‚‚å¸¸ã«é€ä¿¡ï¼‰
function toggleSource() {
  var isCustom = document.querySelector('input[name="source_type"][value="custom"]').checked;
  document.getElementById('preset-site-row').style.display = isCustom ? 'none' : 'block';
  document.getElementById('custom-site-row').style.display = isCustom ? 'block' : 'none';
}

// ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
function openEdit(rowIndex, mode, word, url, memo, freq) {
  document.getElementById('edit-row-index').value = rowIndex;
  document.getElementById('edit-mode').value = mode;
  document.getElementById('edit-freq').value = freq;

  if (mode === 'url') {
    document.getElementById('edit-url-fields').style.display = 'block';
    document.getElementById('edit-kw-fields').style.display = 'none';
    document.getElementById('edit-url').value = url;
  } else {
    document.getElementById('edit-url-fields').style.display = 'none';
    document.getElementById('edit-kw-fields').style.display = 'block';
    document.getElementById('edit-word').value = word;
    document.getElementById('edit-memo').value = memo;
  }
  openModal('edit');
}

// ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.querySelectorAll('.modal-overlay').forEach(function(el) {
  el.addEventListener('click', function(e) {
    if (e.target === el) el.classList.remove('active');
  });
});
</script>
</body>
</html>
